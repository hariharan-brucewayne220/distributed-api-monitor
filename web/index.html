<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Monitor Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .healthy { color: #10b981; }
        .unhealthy { color: #ef4444; }
        .warning { color: #f59e0b; }
        .info { color: #3b82f6; }
        
        .endpoints-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #333;
        }
        
        .endpoint-card {
            background: #f8fafc;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #e5e7eb;
            transition: all 0.3s ease;
        }
        
        .endpoint-card.healthy {
            border-left-color: #10b981;
            background: #f0fdf4;
        }
        
        .endpoint-card.unhealthy {
            border-left-color: #ef4444;
            background: #fef2f2;
        }
        
        .endpoint-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .endpoint-url {
            font-weight: 600;
            color: #333;
            flex-grow: 1;
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-healthy {
            background: #10b981;
            color: white;
        }
        
        .status-unhealthy {
            background: #ef4444;
            color: white;
        }
        
        .endpoint-metrics {
            display: flex;
            gap: 20px;
            font-size: 0.9rem;
            color: #666;
        }
        
        .metric {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            height: 400px;
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            color: #666;
        }
        
        .ai-insights {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .insight-card {
            background: #f0f9ff;
            border-left: 4px solid #3b82f6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .insight-title {
            font-weight: 600;
            color: #1e40af;
            margin-bottom: 8px;
        }
        
        .insight-content {
            color: #475569;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ API Monitor Dashboard</h1>
            <p>Real-time monitoring with AI-powered insights</p>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number healthy" id="healthyCount">-</div>
                <div class="stat-label">Healthy Endpoints</div>
            </div>
            <div class="stat-card">
                <div class="stat-number unhealthy" id="unhealthyCount">-</div>
                <div class="stat-label">Unhealthy Endpoints</div>
            </div>
            <div class="stat-card">
                <div class="stat-number info" id="avgResponseTime">-</div>
                <div class="stat-label">Avg Response Time</div>
            </div>
            <div class="stat-card">
                <div class="stat-number warning" id="uptimePercent">-</div>
                <div class="stat-label">Overall Uptime</div>
            </div>
        </div>
        
        <div class="endpoints-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 class="section-title">üì° Monitored Endpoints</h2>
                <button onclick="toggleAddEndpoint()" style="background: #3b82f6; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">+ Add Endpoint</button>
            </div>
            
            <div id="add-endpoint-form" style="display: none; background: #f0f9ff; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #3b82f6;">
                <h3>Add New API Endpoint</h3>
                <div style="margin-top: 15px;">
                    <input type="url" id="new-endpoint-url" placeholder="Enter API URL (e.g., https://api.example.com/status)" style="width: 70%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; margin-right: 10px;">
                    <button onclick="addEndpoint()" style="background: #10b981; color: white; border: none; padding: 10px 15px; border-radius: 4px; cursor: pointer;">Add</button>
                    <button onclick="toggleAddEndpoint()" style="background: #6b7280; color: white; border: none; padding: 10px 15px; border-radius: 4px; cursor: pointer; margin-left: 5px;">Cancel</button>
                </div>
                <div style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                    ‚ÑπÔ∏è Examples: https://api.github.com/status, https://reqres.in/api/users/1, https://httpbin.org/get
                </div>
            </div>
            
            <div id="endpoints-container">
                <div class="loading">Loading endpoints...</div>
            </div>
        </div>
        
        <div class="chart-container">
            <h2 class="section-title">üìä Response Time Trends</h2>
            <canvas id="responseTimeChart"></canvas>
        </div>
        
        <div class="ai-insights">
            <h2 class="section-title">ü§ñ AI Insights (Powered by GPT-OSS)</h2>
            <div id="insights-container">
                <div class="loading">Generating AI insights...</div>
            </div>
        </div>
    </div>

    <script>
        class APIMonitorDashboard {
            constructor() {
                this.endpoints = [];
                this.chart = null;
                this.initChart();
                this.loadData();
                setInterval(() => this.loadData(), 5000); // Refresh every 5 seconds
            }

            async loadData() {
                try {
                    // Load real data from API
                    const response = await fetch('/api/status');
                    const data = await response.json();
                    
                    this.updateDashboard(data);
                    this.updateChart(data);
                    await this.loadAIInsights();
                } catch (error) {
                    console.error('Failed to load data:', error);
                    // Fallback to mock data if API fails
                    const mockData = this.generateMockData();
                    this.updateDashboard(mockData);
                    this.updateChart(mockData);
                    this.generateAIInsights(mockData);
                }
            }

            async loadAIInsights() {
                try {
                    const response = await fetch('/api/insights');
                    const insights = await response.json();
                    
                    const container = document.getElementById('insights-container');
                    container.innerHTML = insights.map(insight => `
                        <div class="insight-card">
                            <div class="insight-title">${insight.title}</div>
                            <div class="insight-content">${insight.content}</div>
                        </div>
                    `).join('');
                } catch (error) {
                    console.error('Failed to load AI insights:', error);
                }
            }

            generateMockData() {
                const urls = [
                    'https://api.github.com/users/octocat',
                    'https://jsonplaceholder.typicode.com/posts/1',
                    'https://httpbin.org/status/200',
                    'https://httpbin.org/delay/2'
                ];

                return urls.map(url => {
                    const isHealthy = Math.random() > 0.2; // 80% healthy
                    return {
                        url,
                        isHealthy,
                        statusCode: isHealthy ? 200 : 500,
                        responseTime: isHealthy ? Math.random() * 1000 + 100 : Math.random() * 5000 + 1000,
                        lastChecked: new Date().toISOString()
                    };
                });
            }

            updateDashboard(data) {
                const healthy = data.filter(d => d.isHealthy).length;
                const unhealthy = data.length - healthy;
                const avgResponseTime = data.reduce((sum, d) => sum + d.responseTime, 0) / data.length;
                const uptime = (healthy / data.length) * 100;

                document.getElementById('healthyCount').textContent = healthy;
                document.getElementById('unhealthyCount').textContent = unhealthy;
                document.getElementById('avgResponseTime').textContent = Math.round(avgResponseTime) + 'ms';
                document.getElementById('uptimePercent').textContent = uptime.toFixed(1) + '%';

                this.updateEndpointsList(data);
            }

            updateEndpointsList(data) {
                const container = document.getElementById('endpoints-container');
                container.innerHTML = data.map(endpoint => `
                    <div class="endpoint-card ${endpoint.isHealthy ? 'healthy' : 'unhealthy'}">
                        <div class="endpoint-header">
                            <div class="endpoint-url">${endpoint.url}</div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div class="status-badge ${endpoint.isHealthy ? 'status-healthy' : 'status-unhealthy'}">
                                    ${endpoint.isHealthy ? '‚úÖ Healthy' : '‚ùå Down'}
                                </div>
                                <button onclick="removeEndpoint('${endpoint.url}')" style="background: #ef4444; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer; font-size: 0.8rem;">Remove</button>
                            </div>
                        </div>
                        <div class="endpoint-metrics">
                            <div class="metric">
                                <span>Status:</span> <strong>${endpoint.statusCode}</strong>
                            </div>
                            <div class="metric">
                                <span>Response Time:</span> <strong>${Math.round(endpoint.responseTime)}ms</strong>
                            </div>
                            <div class="metric">
                                <span>Last Check:</span> <strong>${new Date(endpoint.lastChecked).toLocaleTimeString()}</strong>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            initChart() {
                const ctx = document.getElementById('responseTimeChart').getContext('2d');
                this.chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Response Time (ms)',
                            data: [],
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Response Time (ms)'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Time'
                                }
                            }
                        }
                    }
                });
            }

            updateChart(data) {
                const now = new Date().toLocaleTimeString();
                const avgResponseTime = data.reduce((sum, d) => sum + d.responseTime, 0) / data.length;

                this.chart.data.labels.push(now);
                this.chart.data.datasets[0].data.push(avgResponseTime);

                // Keep only last 10 data points
                if (this.chart.data.labels.length > 10) {
                    this.chart.data.labels.shift();
                    this.chart.data.datasets[0].data.shift();
                }

                this.chart.update();
            }

            generateAIInsights(data) {
                const container = document.getElementById('insights-container');
                
                // Mock AI insights - replace with actual GPT-OSS integration
                const insights = this.mockAIInsights(data);
                
                container.innerHTML = insights.map(insight => `
                    <div class="insight-card">
                        <div class="insight-title">${insight.title}</div>
                        <div class="insight-content">${insight.content}</div>
                    </div>
                `).join('');
            }

            mockAIInsights(data) {
                const unhealthy = data.filter(d => !d.isHealthy);
                const slowEndpoints = data.filter(d => d.responseTime > 2000);
                
                const insights = [];
                
                if (unhealthy.length > 0) {
                    insights.push({
                        title: "üö® Service Disruption Detected",
                        content: `${unhealthy.length} endpoint(s) are currently down. Consider checking: ${unhealthy.map(e => e.url).join(', ')}`
                    });
                }
                
                if (slowEndpoints.length > 0) {
                    insights.push({
                        title: "‚ö†Ô∏è Performance Degradation",
                        content: `${slowEndpoints.length} endpoint(s) showing elevated response times. May indicate increased load or network issues.`
                    });
                }
                
                const avgResponseTime = data.reduce((sum, d) => sum + d.responseTime, 0) / data.length;
                if (avgResponseTime < 500) {
                    insights.push({
                        title: "‚úÖ Optimal Performance",
                        content: "All endpoints are performing within expected parameters. Average response time is excellent."
                    });
                }
                
                insights.push({
                    title: "üí° Recommendation",
                    content: "Consider setting up automated alerts for response times exceeding 3 seconds to proactively address performance issues."
                });
                
                return insights;
            }
        }

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.dashboard = new APIMonitorDashboard();
        });

        // UI functions for endpoint management
        function toggleAddEndpoint() {
            const form = document.getElementById('add-endpoint-form');
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
            if (form.style.display === 'block') {
                document.getElementById('new-endpoint-url').focus();
            }
        }

        async function addEndpoint() {
            const urlInput = document.getElementById('new-endpoint-url');
            const url = urlInput.value.trim();
            
            if (!url) {
                alert('Please enter a valid URL');
                return;
            }
            
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                alert('URL must start with http:// or https://');
                return;
            }
            
            try {
                const response = await fetch('/api/endpoints', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ url: url })
                });
                
                if (response.ok) {
                    urlInput.value = '';
                    toggleAddEndpoint();
                    // Refresh data immediately
                    window.dashboard.loadData();
                    alert('Endpoint added successfully!');
                } else {
                    const error = await response.text();
                    alert('Failed to add endpoint: ' + error);
                }
            } catch (error) {
                console.error('Error adding endpoint:', error);
                alert('Error adding endpoint. Check console for details.');
            }
        }

        async function removeEndpoint(url) {
            if (!confirm(`Are you sure you want to remove monitoring for: ${url}`)) {
                return;
            }
            
            try {
                const response = await fetch('/api/endpoints', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ url: url })
                });
                
                if (response.ok) {
                    // Refresh data immediately
                    window.dashboard.loadData();
                    alert('Endpoint removed successfully!');
                } else {
                    const error = await response.text();
                    alert('Failed to remove endpoint: ' + error);
                }
            } catch (error) {
                console.error('Error removing endpoint:', error);
                alert('Error removing endpoint. Check console for details.');
            }
        }

        // Allow adding endpoint with Enter key
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('new-endpoint-url').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    addEndpoint();
                }
            });
        });
    </script>
</body>
</html>